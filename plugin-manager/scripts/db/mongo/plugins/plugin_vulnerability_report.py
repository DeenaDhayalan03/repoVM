from scripts.constants.db_constants import DatabaseConstants
from scripts.db.mongo import CollectionBaseClass, mongo_client

from . import database

collection_name = DatabaseConstants.collection_plugin_security_check


class VulnerablityScanReport(CollectionBaseClass):
    def __init__(self, project_id=None):
        super().__init__(
            mongo_client,
            database=database,
            collection=collection_name,
            project_id=project_id,
        )

    def create_record(self, plugin_id: str, data: dict):
        self.update_one(query={"plugin_id": plugin_id}, data=data, upsert=True)

    def get_report(self, plugin_id: str):
        return self.find_one(query={"plugin_id": plugin_id}, filter_dict={"_id": 0})

    def get_all_reports(self):
        return self.find(query={}, filter_dict={"_id": 0})

    def update_record(self, plugin_id: str, data: dict):
        resp = self.update_one(query={"plugin_id": plugin_id}, data=data, upsert=True)
        return resp.modified_count
